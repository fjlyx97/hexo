---
title: 从inode角度看硬链接和软链接
date: 2020-04-14 16:11:17
tags:
- linux
- 学习
categories : "linux"
---

> - 硬链接和软链接的差异
> - inode在底层上的显示

<!--more-->

# 查看inode
1. 使用stat+文件名查看
```
stat test.cpp
  File: 'test.cpp'
  Size: 324       Blocks: 8          IO Block: 4096   regular file
Device: fd01h/64769d    Inode: 387692      Links: 2
Access: (0664/-rw-rw-r--)  Uid: (  500/  ubuntu)   Gid: (  500/  ubuntu)
Access: 2020-03-09 17:06:10.255812494 +0800
Modify: 2020-04-14 16:06:25.380410268 +0800
Change: 2020-04-14 16:06:25.388410268 +0800
```

2. 使用ls -i查看
```
ls -i test.cpp
387692 test.cpp
```

总的来说，在inode当中还是包含了好多内容，如文件字节数，文件拥有者UID，文件的读写权限。其中有几个相对重要的。
- inode:正式的inode编号
- change:inode上一次变动的时间
- modify:文件内容上一次变动的时间
- access:文件上一次打开的时间
- 链接数（link）：即有多少文件名指向这个inode

# cp命令
1. 在执行一个cp命令的时候，系统会分配一个未被使用的inode号，在inode表中新增项目。如果是覆盖的话，inode不变，沿用之前的inode号。
2. 新建一个目录项，指向inode
3. 数据复制到block中

# mv命令
经常可以观察到，如果在同一个磁盘当中，进行剪切移动文件，速度非常快，因此原理主要为：
1. 新建目录项
2. 删除源文件的目录项
3. 目标文件名会指向源文件的inode，数据不发生任何移动（只修改inode，创建删除目录项）

另外一种情况是跨磁盘移动，则可以看成是一个cp+rm的过程。

# rm命令
系统会将当前文件的inode link进行减一，如果link数变为0，则释放inode。但是数据其实并没有被删除，意味着除非覆盖了数据，不然数据是允许找回的。

# ln命令
## 硬链接
一般来说，文件名和inode一一对应，但是如果使用了硬链接，会发现硬链接和源文件指向同一个inode号，而link的值会+1。因此可以满足其中一个文件修改，会造成所有的文件都会变动。但是如果只是删除的话，不会影响其他文件的访问，除非link变为了0
- 硬链接会占用与源文件等值的空间大小。

## 软链接（ln -s）
软链接被称为符号链接，同样可以通过不同文件名访问同一个数据。但是不同的是，软链接有着自己的inode。（windows下体验为快捷方式）
- 如果文件A是文件B的软链接，那么文件A存放的其实是文件B的路径名
