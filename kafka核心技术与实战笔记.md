---
title: kafka核心技术与实战笔记
date: 2020-05-07 10:25:09
tags:
- 编程
- 学习
- 消息队列
categories : "消息队列"
---

> - 阅读kafka核心技术与实战
> - 记录学习kafka的过程

<!--more-->

# 入门术语
- 消息：Record。Kafka 是消息引擎嘛，这里的消息就是指 Kafka 处理的主要对象。
- 主题：Topic。主题是承载消息的逻辑容器，在实际使用中多用来区分具体的业务。
- 分区：Partition。一个有序不变的消息序列。每个主题下可以有多个分区。
- 消息位移：Offset。表示分区中每条消息的位置信息，是一个单调递增且不变的值。
- 副本：Replica。Kafka 中同一条消息能够被拷贝到多个地方以提供数据冗余，这些地方就是所谓的副本。副本还分为领导者副本和追随者副本，各自有不同的角色划分。副本是在分区层级下的，即每个分区可配置多个副本实现高可用。
- 生产者：Producer。向主题发布新消息的应用程序。
- 消费者：Consumer。从主题订阅新消息的应用程序。
- 消费者位移：Consumer Offset。表征消费者消费进度，每个消费者都有自己的消费者位移。
- 消费者组：Consumer Group。多个消费者实例共同组成的一个组，同时消费多个分区以实现高吞吐。
- 重平衡：Rebalance。消费者组内某个消费者实例挂掉后，其他消费者实例自动重新分配订阅主题分区的过程。Rebalance 是 Kafka 消费者端实现高可用的重要手段。
- 缓存代理：Broker，Kafka集群中的一台或多台服务器统称broker.

# 为什么kafka适合部署在linux
主流的 I/O 模型通常有 5 种类型：阻塞式 I/O、非阻塞式 I/O、I/O 多路复用、信号驱动 I/O 和异步 I/O。kafka使用了java的selector，其底层在linux上为epoll而在windows上为select，因此明显linux更优。

网络模型同样有差异，linux当中拥有zero copy技术，可以避免磁盘和网络间的性能损耗。

# 磁盘问题
Kafka大量使用磁盘，但是基于顺序读写，因此SSD并没有太大的性价比。

规划磁盘容量需要考虑以下几点：
1. 新增消息数
2. 消息保存时间
3. 消息大小
4. 备份数
5. 压缩率

# Broker重要参数
## 存储信息
- log.dirs：非常重要，无默认值，需要自己制定，为每个Broker指定日志文件位置。

## Zookeeper
- zookeeper.connect，设置zookeeper集群，可以通过proxy来达到只设置一个的目的。