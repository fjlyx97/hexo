---
title: Http协议笔记
date: 2020-08-12 15:11:10
tags:
- 学习
- http
- linux
categories : "Linux"
---

> - Http协议笔记
> - 基于极客时间专栏
> - 鱼总是最后看见水的

<!-- more-->

# HTTP是什么
超文本传输协议，可以拆分成三个部分：超文本、传输、协议。Http协议没有实体，依赖许多其他技术实现，但是许多技术也依赖它。

## 协议
协议必须要有两个或者多个参与者，是一种行为约定和规范。

## 传输
传输可以看成把一堆东西从A点搬到B点，即 A <--> B。
- 数据虽然在A,B间传输，但是并没有限制只有A和B两个角色，允许中间有**中转**和**接力**，如A <--> X <--> Y <--> Z <--> B

中间人可以有任意多个，但是也必须遵从HTTP协议，只要不打扰基本的数据传输，就可以添加任意的额外功能，如：安全认证，数据压缩，编码转换等。

## 超文本
超越了普通文本的文本，可以是文字、图片、视频等混合体，最关键是含有**超链接**

# 万维网
互联网的正式名称是Internet，但是浏览器访问的其实是其中的一个子集：**万维网（WWW）**，基于HTTP协议。但是互联网还有很多其他资源，如电子邮件、FTP文件下载、SSH安全登录、即时通信服务等。

# 域名的形式
```
www.baidu.com
主机名.二级域名.顶级域名
```

# 常用头字段
Http协议规定了非常多的头部字段，功能基本可以分为四大类：
1. 通用字段：在请求头和响应头都可以出现
2. 请求字段：仅能出现在请求头里，进一步说明请求信息或其他条件
3. 响应字段：仅能出现在响应头里，补充说明响应报文的信息
4. 实体字段：通用字段，描述body的额外信息

## Host字段
请求字段，在请求头里，Http/1.1必须出现的字段。当一个服务器配置了多个虚拟主机，服务器端就可以通过Nginx来选择，有点像简单的**路由重定向**

## User-Agent字段
请求字段，描述发起Http请求的客户端，服务器可以通过它来访问最适合浏览器显示的界面

## Date
通用字段，标识Http报文创建的时间，客户端可以使用这个时间再搭配其他字段决定缓存策略

## Server
相应字段，只能出现在响应头里面，告诉客户端当前正在提供Web服务的软件名称和版本号

# 标准请求方法
## GET/HEAD
Get含义是从服务器获取资源，可以为文本、图片、视频，也可以是PHP,Java动态生成的界面或者其他数据格式。Head方法和Get方法相似，但是服务器**不会返回实体数据，只会返回响应头**。

- 如果要检查一个文件是否存在，就可以用Head方法，没必要用Get把整个文件取下来。

## POST/PUT
Put作用和Post类似，但是有着微妙的不同。Post表示新建，Put表示修改。实际上，Put用的极少，有的服务器甚至禁用了Put方法。

## 其他方法
1. Delete方法，一般不轻易使用，服务器一般只会对资源做一个删除的标记
2. Connect方法，要求服务器为客户端和另一台远程服务器建立隧道，服务器充当代理
3. Options方法，要求服务器列出可对资源实行的操作方法，再响应头的Allow字段返回，用处不大。（Nginx干脆不支持）
4. Trace方法，用于对Http链路的诊断，存在漏洞，通常禁止使用

# 状态码
## 1XX
提示信息，是协议的中间状态，实际用到很少

## 2xx
标识服务器接收，并成功处理了客户端的请求
- 200，最常见的成功码，如果请求方法不是HEAD，将返回body
- 204，含义和200相同，但是不返回
- 206，http分块下载的基础，通产会伴随着Content-Range

## 3xx
一般表示请求的资源放生了变动，客户端必须使用新的URI重新获取资源
- 301，永久重定向
- 302，临时重定向
- 304，一般配合If-Modified-Since等条件的请求，资源未修改，缓存控制

## 4xx
客户端报文有误，服务器无法处理
- 400，BadRequest，笼统的错误，不推荐服务器返回
- 403，Forbidden，不一定是请求出错，有可能表示服务器禁止访问资源
- 404，NotFound

## 5xx
客户端请求报文正确，服务器内部出现了错误，无法返回应有的数据
- 500，通用错误码，客户端无法感知服务器内部究竟发生了什么错误
- 502，服务器作为网关返回的错误码，代表无法访问后端服务器
- 503，Service Unavailable,

# Http协议的特点
## 灵活可拓展
可以传输任意数据，并且Header可以任意扩展

## 可靠传输
基于TCP/IP，因此继承了可靠传输的特性。

## 应用层协议
应用层协议有很多，但是大多局限在很小的场景如FTP,SMTP,SSH。Http协议可以携带任意头字段，实体数据的报文结构，可以看成万金油的协议。

## 无状态
每次收发报文都是独立的，没有任何联系，连接不会保存信息

# 内容协商的质量值
Header中的Accept,Accept-Encoding、Accept-Language，进行协商的时候，会用一种特殊的“q”参数来表示权重，设定优先级。
- 权重最大值是1，最小值是0.01，默认值是1，值为0表示拒绝。

# 分块传输
Http协议使用chunked分块传输编码，在响应报文用**Transfer-Encoding:chunked**来表示需要分块发送。
- **Transfer-Encoding: chunked**和**Content-Length**这两个字段是互斥的，不能同时出现，一个报文要么是长度已知，要么是长度未知（分块）

# Cookie属性
Cookie可以通过响应包的**Set-Cookie**设置。有效期可以通过Expires和Max-Age两个属性来设置。
- Expire，过期时间，用的是绝对时间
- Max-Age，用二十相对时间，单位是秒

Domain和Path可以设定Cookie所属的域名和路径。浏览器在发送Cookie的时候，会从uri提取出host和path部分，对比Cookie属性，如果不满足条件，就不会在请求头里面发送Cookie

# Cache属性
头部字段：Cache-Control，里面可以设置max-age=30，意味着缓存30秒，但是这个字段不仅仅只存在于response，request也可以请求缓存。如果点击浏览器的前进或者后退按钮，是可以触发的。
